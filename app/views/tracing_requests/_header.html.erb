<% #TODO this will be refactored in solr branch. %>
<h1 class="no_border float_left"><%= t("tracing_requests.label") %></h1>
<% if can? :create, TracingRequest %>
  <%= link_to content_tag(:span, t("tracing_requests.register_new_tracing_request"), :class => 'create_tracing_request'), new_tracing_request_path, :class=>'btn green-button right' %>
<% end %>

<%# TODO: Removing the export link temporarily %>
<% if false %>
<% if RapidftrAddon::ExportTask.active.any?{|export_task| can?("export_#{export_task.id}".to_sym, Incident)} %>
<div class="btn dropdown_btn">
  <span class="export"><%= t("incidents.export") %></span>
  <div class="dropdown hide">
    <% RapidftrAddon::ExportTask.active.each do |export_task| %>
      <% if can?("export_#{export_task.id}".to_sym, Incident) %>
        <%= link_to t("addons.export_task.#{export_task.id}.all"), incidents_path(:format => export_task.id, :per_page => :all), :class => "password-prompt" %>
      <% end %>
    <% end %>
  </div>
</div>
<% end %>
<% end %>

<script type="text/javascript">
  $(".export-password-prompt").each(function() {
    var el = $(this);
    el.data("original-href", el.attr("href"));
    el.data("password", null);
  });

  $(".export-password-prompt").click(function() {
    var el=$(this), password=el.data("password"), href=el.attr("original-href");
    if (password == null || password == undefined || password == "") {
      password = prompt("Enter password");
      el.attr("href", href + (href.indexOf("?") == -1 ? "?" : "") + "&password=" + escape(password));
    }
  });
</script>
